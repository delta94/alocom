var FACEBOOK_ID=0,FULLNAME="";app.controller("GCController",function(e,n,o){var s=this,t="";s.today=function(){var e=new Date;return e.getDate()+"/"+(e.getMonth()+1)},s.menu={visible:!1,raw:"",array:[],host:{fbid:0,fullname:""},onConfirm:function(){this.visible=!1;for(var e=this.raw.split(/\s*\n\s*/),o=[],s=/^[0-9]+\.\s+.+$/,r=0;r<e.length;r++){var c=e[r];s.test(c)&&o.push(c)}console.log("con heo",o),n.post(t+"/menu",{menu:o,fbid:FACEBOOK_ID,fullname:FULLNAME}).success(function(e){console.log(e),u()})}},s.vote={doVote:function(e){n.post(t+"/vote",{dish:e.id,fbid:FACEBOOK_ID,fullname:FULLNAME}).success(function(){u()})},checkYou:function(e){for(var n=0;n<e.list.length;n++)if(e.list[n].fbid===FACEBOOK_ID)return!0;return!1}},s.users={all:[],checked:{}};var u=function(){n.get(t+"/menu").success(function(e){console.log(e),s.menu.array=e.menu,s.menu.host=e.host,s.users.checked={};for(var n=0;n<e.menu.length;n++)for(var o=e.menu[n].list,t=0;t<o.length;t++)s.users.checked[o[t].fbid]=!0;r()}).error(function(){s.menu.array=fakeMenu.menu})},r=function(){n.get(t+"/users").success(function(e){console.log(e),s.users.all=e.users})};u(),s.loggined=function(e,n){FACEBOOK_ID=e,FULLNAME=n,console.log("fbid = ",e,"name = ",n)},s.sendDone=function(){n.post(t+"/done",{fbid:FACEBOOK_ID,fullname:FULLNAME})},o(u,5e3)});